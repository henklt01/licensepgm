<!-- templates/manage_licenses/manage-licenses.html -->

{% extends "base.html" %}
{% block title %}Manage Licenses{% endblock title %}

{% block head %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'manage_licenses/css/style.css' %}">
<script src="{% static "manage_licenses/js/script.js" %}"></script>
{% endblock head %}

{% block banner %}
<div class="flex-container flex-row border-top app-banner">
  <div class="tab">
  <button class="js-tablinks" id="js-default-open" onclick="changePage(event, 'licenses-tab')">My licenses</button>
  <button class="js-tablinks" onclick="changePage(event, 'products-tab')">My products</button>
  </div>
  <div class="nav-row navigation-buttons">
    <p><a href="{% url 'homepage' %}">Home</a></p>
    <p><a href="{% url 'logout' %}">Log Out</a></p>
  </div>
</div>
{% endblock banner %}

{% block logocontainer %}{% endblock logocontainer %}

{% block main %}
<div class="flex-container">
  <h2 class="text-container"> Manage Licenses </h2>
  <div class="flex-box">
  <p class="text-container"> {{ user_email }} - {{ user_role }} - {{ user_org }} </h3>
  </div>
</div>

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}

<div id="licenses-tab" class="js-tabcontent">
  <script>document.getElementById("js-default-open").click();</script>

  <div class="flex-container">
    <div class="flex-container container-border">
      <p class="text-container">
      This screen displays the licenses for the entire Organization. If you want to view associated products, 
      click on 'View my products' menu item above.
      </p>
    </div>
  </div>

  <div class="flex-container">
    <div class="widget-box">
      <form method = "post">
          {% csrf_token %}
          {{ new_license_form }}
          <p><input class="button" type="submit" value="Save License"/></p>
      </form>
    </div>
  </div>

  <div class="flex-container flex-center border-top">
    <div class="flex-container flex-center">
      <h2 class="text-container border-bottom"> Licenses </h2>
    </div>

    <form method="get">
      <div class="table-scroll">
        <table> 
        <tr>
          <th></th>
          <th>Product Name</th>
          <th>Creator</th>
          <th>Version</th> 
          <th>IP</th>
          <th>Permanent</th>
          <th>Grade</th>
          <th>Stations</th>
          <th>Start Date</th>
          <th>Exp Date</th> 
        </tr>

        {% for license in product_licenses %}
        <tr>
          <td><input type="checkbox" name="license_selection" value="{{ license.id }}"></td>
          <td>{{ license.product_name }}</td>
          <td>{{ license.creator_email }}</td>
          <td>{{ license.version_number }}</td>
          <td>{{ license.IP_Host }}</td>
          <td>{{ license.is_permanent }}</td>
          <td>{{ license.product_grade }}</td>
          <td>{{ license.product_stations }}</td>
          <td>{{ license.creation_date }}</td>
          <td>{{ license.expiration_date }}</td>
        </tr>
        {% endfor %} 
        </table>
      </div>

      <div class="flex-container flex-row border-top">
        <p class="text-container"><input type="submit" name="generate_license_selection" value="Generate Selection"></p>
        <p class="text-container"><input type="submit" name="delete_license_selection" value="Delete Selection"></p>
      </div>

      <div class="flex-box">
        <p class="text-container"><a href="{% url 'download_license' %}">Download</a></p>
      </div>

    </form>
  </div>
</div>

<div id="products-tab" class="js-tabcontent">

 <div class="flex-container">
    <div class="widget-box">
      <p class="text-container">Filter licenses Using the Fields Below</p>
        <form method = "GET">
          <input class="button" type="submit" value="Search"/>
          {{ search_form }}
        </form>

        <form method="get">
          {% csrf_token %}
          <input class="button" type="submit" name="clear_search" value="Clear Search"/>
        </form>
      </div>
  </div>

  <div class="flex-container flex-center border-top">
      <h2 class="text-container border-bottom"> Product Entitlements </h2>

      <table> 
        <tr>
          <th>Product Name</th>
          <th>Product Version</th> 
          <th>Allocated Licenses</th>
        </tr>

        {% for entitlement in entitlement_list %}
          <tr>
            <td>{{ entitlement.product_name }}</td>
            <td>{{ entitlement.access_code }}</td>
            <td>{{ entitlement.num_allocated }} </td>
          </tr>
        {% endfor %} 
      </table>
  </div>
</div>

<div class="flex-container border-top">

{% endblock main%}